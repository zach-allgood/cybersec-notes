---
tags: [pentesting, tool, network, enumeration]
---
## Summary

Nmap is a free and open-source network scanner created by Gordon Lyon. Nmap is used to discover hosts and services on a computer network by sending packets and analyzing the responses. Nmap provides a number of features for probing computer networks, including host discovery and service and operating system detection.

The materials OffSec provides for the lab and the exam has some basic nmap related exercises to get your feet dirty. It’s highly recommended to review the nmap man pages: [https://linux.die.net/man/1/nmap](https://linux.die.net/man/1/nmap) or even find examples online.

Before I found some automated tools, I personally would run the same nmap scans against every machine in the labs. These commands are as follows:

```
nmap -sC -sV IP_ADDRESS  
nmap -sC -sV -p- IP_ADDRESS  
nmap -sU -sV --top-ports 20 IP_ADDRESS  
nmap --script vuln IP_ADDRESS
```

`nmap -sC -sV IP_ADDRESS`

The above command effectively runs a scan with all default scripts and banner/service grabbing and runs against the top common ports

`nmap -sC -sV -p- IP_ADDRESS`

This command is very similar to the first one. Except now we are running a full port scan from port 1 through port 65535.

`nmap -sU -sV --top-ports 20 IP_ADDRESS`

The command above runs a UDP scan while displaying banner/service information against the top 20 common UDP ports.

`nmap --script vuln IP_ADDRESS`

The command above runs all of the Nmap Scripting Engine (NSE) scripts that are used for vulnerability detection.

## Common Flags

- -sS: Perform a TCP SYN scan
- -sU: Perform a UDP scan
- -sV: Probe open ports to determine service/version info
- -O: Enable OS detection
- -v: Enable verbosity. You can even set the verbosity level as such :
    - -vv: Level 2 verbosity. The minimum level of verbosity advised for use.
    - -v3: Level 3 verbosity. You can always specify the verbosity level by specifying a number like this.
- -oA: Same Nmap output in “normal”, XML and grepable formats. However you can specify the format of your choice with :
    - -oN: Redirect normal output to a given filename
    - -oX: Produce output in a clean, XML format and store it in a given file
    - -oG: Produce “grepable” output and store it to a file. Deprecated format as users are now moving towards XML outputs.
- -A: Enables “aggressive” scanning. Presently this enables OS detection (-O), version scanning (-sV), script scanning (-sC) and traceroute (–traceroute)
- -p: Specify the ports to scan. It can be a single port as well as a range of ports. For Example :
    - `nmap -p 80 127.0.0.0.1`: This scans port 80 on localhost
    - `nmap -p 1-100 127.0.0.1`: This scans ports from 1 to 100 on localhost
    - `nmap -p- 127.0.0.1`: This scans all the ports on the localhost

## Scan Types

### TCP Scans (-sT)

In this type of scan, Nmap sends a [TCP packet](https://www.digitalocean.com/community/tutorials/difference-between-tcp-and-udp-protocols) to a port with the SYN flag set. In this scenario two things can occur :

- The target responds with an RST packet that signifies that the port is closed.
- Target doesn’t respond at all, probably due to a firewall dropping all incoming packets in which case the port will be considered filtered
- The target responds back with a TCP packet with the SYN/ACK flags set which would signify that the port is open and then Nmap would respond with a TCP packet with the ACK flag set and hence would complete the TCP 3-way handshake.

This is not a very reliable scan technique as it is easy to configure a firewall rule to respond back with RST packets or drop all incoming packets. Also this method is extremely slow as it waits for the entire TCP 3 way handshake.

### Syn "Half-open" Scans (-sS)

SYN scans, also known as “Half-Open” or “Stealth Scan” are an improvement over the previous method. In the previous method where we were sending back a TCP packet with the ACK flag set after receiving an SYN/ACK packet, now we would be sending an RST packet. This prevents the server from repeatedly trying to make the requests and massively reduces scan times.

This method is an improvement on the previous ones because:

- They are faster
- They might be able to bypass some primitive firewalls
- Often, SYN Scans are not logged by applications running on the ports as most applications start logging a connection only after it has been fully established which is not the case with SYN Scans

However, it is not advisable to run SYN Scans on production environments as it might break certain unstable applications. It is also to be noted that SYN scans also require [sudo privileges](https://www.digitalocean.com/community/tutorials/sudo-command-in-linux) because it needs to craft raw packets.

Infact, when run with sudo privileges, nmap defaults to SYN Scans, otherwise it defaults to TCP scan.

### UDP Scans (-sU)

UDP scans are much less reliable than the previous two as UDP connections are stateless by nature. This means that there’s no “feedback mechanism” like TCP. UDP works on the principle “Fire and Forget” which means that it sends packets directed to targets at certain ports and hopes that they would make it. This gives more emphasis on speed than quality. However, the lack of a feedback mechanism makes it difficult to identify open ports.

When an UDP packet is sent to a target port, there might be three scenarios :

- Usually there is no response received in which case nmap marks the port as open|filtered. If no response is received yet, it sends another UDP packet to double check and if yet again no response is received, it marks the port as open|filtered and moves on
- It might get a UDP response back which is very rare. In such a scenario, the port is marked open
- If the port is closed and it receives an ICMP echo request back which signifies that the port is unreachable.

### TCP Null Scans (-sN)

In TCP Null Scans, the TCP packets sent don’t have any of the flags set. According to RFC, under such a circumstance, the target should respond back with an RST if the port i s closed

### TCP Fin Scans (-sF)

This is very similar to the TCP Null Scan except for the fact that instead of sending a completely empty TCP packet, it sends a packet with the FIN flag set which is used to gracefully close a connection. Accordingly the target must respond back with an RST for closed ports as per RFC.

### TCP Xmas Scans (-sX)

TCP Xmas Scans is also very similar to the last two scan techniques except for the fact that they use TCP packets with the PSH, URG and FIN flags set. Like the last two scan types, this too expects RST packets for closed ports under RFC.