
```
xfreerdp /v:ip /u:user /d:domain /drive:linux,/home/kali/pen200
```

```
powershell -ep bypass
```

```
Import-Module .\function.ps1
```

Search Users
```
LDAPSearch -LDAPQuery "(samAccountType=805306368)"
```

Search Groups
```
LDAPSearch -LDAPQuery "(objectclass=group)"
```

Loop over groups to display properties CN and member
```
foreach ($group in $(LDAPSearch -LDAPQuery "(objectCategory=group)")) {
>> $group.properties | select {$_.cn}, {$_.member}
>> }
```

Search Specific group
```
$sales = LDAPSearch -LDAPQuery "(&(objectCategory=group)(cn=Sales Department))"
```

## PowerView

https://powersploit.readthedocs.io/en/latest/Recon/



```
powershell -ep bypass
```

```
cp Microsoft.PowerShell.Core\FileSystem::\\tsclient\linux\PowerView.ps1 .\
```

```
Import-Module .\PowerView.ps1
```

Get Domain info
```
Get-NetDomain
```

List All Users
```
Get-NetUser
```

Get All Users' CN
```
Get-NetUser | select cn
```

```
Get-NetUser | select cn,pwdlastset,lastlogon
```

Get All Group CNs
```
Get-NetGroup | select cn
```

Get Group's Members
```
Get-NetGroup "Sales Department" | select member
```

Get Computer Objects
```
Get-NetComputer
```

```
Get-NetComputer | select operatingsystem,dnshostname
```

Find Local Admin Access for Current User
```
Find-LocalAdminAccess
```

Find Logged In Users
```
Get-NetSession -ComputerName files04
```

```
Get-NetSession -ComputerName files04 -Verbose
```

Find SPNs
```
Get-NetUser -SPN | select samaccountname,serviceprincipalname
```

Get Object ACLs
```
Get-ObjectAcl -Identity stephanie
```

Convert SID to Name
```
Convert-SidToName S-1-5-21-1987370270-658905905-1781884369-1104
```

Convert Multiple SID to Name
```
"S-1-5-21-1987370270-658905905-1781884369-512","S-1-5-21-1987370270-658905905-1781884369-1104","S-1-5-32-548","S-1-5-18","S-1-5-21-1987370270-658905905-1781884369-519" | Convert-SidToName
```

Find SIDs with "GenericAll" rights within the Management Department
```
Get-ObjectAcl -Identity "Management Department" | ? {$_.ActiveDirectoryRights -eq "GenericAll"} | select SecurityIdentifier,ActiveDirectoryRights
```

Find Domain Shares
```
Find-DomainShare
```

## PsLoggedOn

https://learn.microsoft.com/en-us/sysinternals/downloads/psloggedon

Show logged on users for specified machine
```
.\PsLoggedon.exe \\files04
```

```
.\PsLoggedon.exe \\web04
```


## Finding Service Accounts

Found iis_service user previously

Find SPNs related to user
```
setspn -L iis_service
```


## SharpHound

https://github.com/BloodHoundAD/SharpHound/releases

```
powershell -ep bypass
```

```
cp Microsoft.PowerShell.Core\FileSystem::\\tsclient\linux\SharpHound.ps1 .\
```

```
Import-Module .\SharpHound.ps1
```

Invoke Bloodhound
```
Get-Help Invoke-BloodHound
```

```
Invoke-BloodHound -CollectionMethod All -OutputDirectory C:\Users\stephanie\Desktop\ -OutputPrefix "corp audit"
```

On Kali machine

```
sudo neo4j start
```

Navigate to http://localhost:7474

Login with default creds neo4j/neo4j

Change password

```
bloodhound
```

Login using new password

Upload data using the upload button on the right